---
- tags: [minimal]
  block:
    - name: configure sudoers
      become: true
      ansible.builtin.blockinfile:
        path: /etc/sudoers.d/99-{{user.name}}
        create: true
        marker: "# {mark} ansible:({{role_name}}) -->"
        block: |
          {{user.name}} ALL=(ALL) NOPASSWD: ALL
          Defaults:{{user.name}} env_reset
          Defaults:{{user.name}} env_keep -= "PATH"
          Defaults:{{user.name}} env_delete += "PATH"
        validate: visudo -cf %s
    
    - name: create .profile.d directory
      ansible.builtin.file:
        path: "{{user.home}}/.profile.d"
        state: directory
    
    - name: set path facts
      ansible.builtin.set_fact:
        user_profiled_path: "{{user.home}}/.profile.d"
...